<!--
    Autor: Adrián Arévalo Aguirre
-->
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
        DOMOLabo B105
    </title>
  
    <!-- Importo el módulo socket.io que tengo en el proyecto -->
  <script src="/socket.io/socket.io.js"></script>
  
    <!-- jQuery y DataTables -->
  <script type="text/javascript" language="javascript" src="//code.jquery.com/jquery-1.11.1.min.js"></script>
  <script type="text/javascript" language="javascript" src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script>
   
   <!-- CSS -->
  <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/tabletools/2.2.4/css/dataTables.tableTools.css">
  <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/plug-ins/1.10.7/integration/bootstrap/3/dataTables.bootstrap.css">

  <!-- Latest compiled and minified JavaScript --> 
  <script type="text/javascript" language="javascript" src="//netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script type="text/javascript" language="javascript" src="//cdn.datatables.net/plug-ins/1.10.7/integration/bootstrap/3/dataTables.bootstrap.js"></script>

</head>

<body>

<div class="container

  <!--Pannel Heading-->
    <div class="row marketing">
      <div class="col-lg-12">
        <div class="panel panel-primary" style="width:100%;">
          <div class="panel-heading"" >Panel Informacion Sensores B105</div>
          <div class="panel-body">
	   <div class="col-lg-6">
            <p>Here you can see the general info of the sensors availabe,add, modify and delete sensors of the Domotics system.</p>
           </div>
	   <div class="col-lg-6">
	    <div class="btn-group pull-right">
             <a href="/" class="btn btn-primary btn-sm">Medidas</a>
             <a class="btn btn-info btn-sm">Reset AP</a>
	    </div>
           </div>
          </div>
         </div>
        </div>
       </div>
    
   <!--Tabla de Sensores-->
  <div class="row-markering">
   <div class="col-lg-4" style="padding-bottom: 15px;">
   <div class="btn-group" role="group">
    <button type="button" id="buttonRes" class="btn btn-info">
     <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>Reset ED
    </button>
    <button type="button" id="ButtonTimer" class="btn btn-warning">
     <span class="glyphicon glyphicon-time" aria-hidden="true"></span>Set Timer
    </button>
    <button type="button" id="buttonDel" class="btn btn-danger">
      <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>Eliminar
    </button>
   </div>
   </div>
   <div class="col-lg-8" style="padding-bottom: 15px;">
    <label class="checkbox-inline">
     <input type="checkbox" id="CheckMedidas"> Eliminar medidas
     <input type="number" id="inputTsleep" class="form-control" placeholder="Tsleep">
     <input type="number" id="inputWake" class="form-control" placeholder="TWake">
    </label>
   </div>
  </div>

  <div class="row-markering">
   <table id= "sensorTable" class="table table-hover" style="text-align:center;" data-click-to-select="true">
        <thead>
            <tr>
                <th class="text-center">Id</th>
                <th class="text-center">Tipos</th>
                <th class="text-center">Localizacion</th>
                <th class="text-center">Bateria</th>
            </tr>
        </thead>
        <tbody></tbody>
       </table>
   
    <form id="sensor-form">
        <div class="col-lg-6">
          <div class="form-group">
            <label for="inputId" class="col-lg-3 control-label">Id</label>
              <div class="col-lg-9" style="padding-bottom: 15px;">
                <input type="number" class="form-control" id="inputId" placeholder="Identif." min="1">
              </div>
          </div>
          <div class="form-group">
            <label for="inputLoc" class="col-lg-3 control-label">Localizacion</label>
              <div class="col-lg-9" style="padding-bottom: 15px;">
                <input type="number" class="form-control" id="inputLoc" placeholder="Localiz.">
              </div>
          </div>
      </div>

        <div class="col-lg-6">
          <label class="checkbox-inline">
            <input type="checkbox" id="CheckTemp" value="Temp">Temp
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" id="CheckPres" value="Pres">Pres
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" id="CheckLum" value="Lum">Lum
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" id="CheckBat" value="Bat">Bat
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" id="CheckCons" value="Cons">Cons
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" id="CheckAtm" value="Atm">Atm 
          </label>
          <label class="checkbox-inline">
            <input type="checkbox" id="CheckHum" value="Hum">Hum 
          </label>

           <div class="form-group">
            <div class="col-lg-offset-2 col-lg-10" style="padding-top: 15px;">
              <button type="button" class="btn btn-primary" id= "buttonSave">Guardar</button>
              <button type="button" class="btn btn-default" id="buttonReset">Reset</button>
            </div>
          </div>
        </div>
    </form>
  </div>    
    
  <!-- Se creara la tabla dinamicamente con Javascript e Interfaces DOM -->
  <script>

    // Creo un WebSocket.
     var socket = io.connect('http://'+ location.host);
     // console.log(location.host);
     // Cargo la tablaSensores

   $(document).ready(function(){
     var table = $('#sensorTable').DataTable( {
               "sRowSelected": "single"
                 });
    
     //Carga de la Tabla
     socket.on('SLoad', function (data) {
        table.row.add(data);
        table.draw(false);
      });

    //Seleccion de filas
    $('#sensorTable tbody').on( 'click', 'tr', function () {
        if ( $(this).hasClass('selected') ) {
            $(this).removeClass('selected');
	    $(this).removeClass('warning');
        }
        else {
            table.$('tr.selected').removeClass('warning');
            table.$('tr.selected').removeClass('selected');
            $(this).addClass('selected');
            $(this).addClass('warning');
        }
    });

     //Boton de borrado filas tabla
     $('#buttonDel').click( function () {
        var rowData = table.row('.warning').data();
	var flag = $('#CheckMedidas').is(':checked');
	//Borramos el sensor y/o las medidas del servidor
	socket.emit('SDelete',rowData[0],flag);
	//Lo borramos de la tabla
        table.row('.warning').remove().draw( false );
	//draw false para quedarse en la misma pagina
     });

     //Boton de guardado de formulario
     $("#buttonSave").click(function(){
	var id = $('#inputId').val();
	var loc = $('#inputLoc').val();
	tipos="";
	$("input:checkbox:checked").each(function() {
           var tipo = $(this).val();
	   tipos=tipos+tipo+", ";
	});
	//Lo guardamos en el servidor
	socket.emit('SNew',[id,tipos,loc]);
	//Lo guardamos en la tabla
	table.row.add([id,tipos,loc,5]);
	table.draw();        
     });

     //Boton de reset de formulario
     $("#buttonReset").click(function(){
       $('#sensor-form').each (function(){
        this.reset();
       });
     });

  });
  </script>
  </body>
</html>
